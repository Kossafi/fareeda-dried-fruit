<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏´‡∏°‡πà - ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πä‡∏≠‡∏Ñ‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏≠‡∏ö‡πÅ‡∏´‡πâ‡∏á</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ü•≠</text></svg>">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root {
            --primary-gold: #FFD700;
            --primary-orange: #FFA500;
            --primary-deep-orange: #FF8C00;
            --bg-cream: #FFF8DC;
            --bg-light-yellow: #FFFACD;
            --bg-warm-white: #FEFEF7;
            --text-dark: #2C1810;
            --text-brown: #8B4513;
            --success-green: #32CD32;
            --warning-amber: #FFBF00;
            --danger-red: #FF6B6B;
            --shadow-warm: rgba(255, 165, 0, 0.15);
            --shadow-soft: rgba(0, 0, 0, 0.08);
        }

        body {
            font-family: 'Prompt', sans-serif;
            background: linear-gradient(135deg, var(--bg-cream) 0%, var(--bg-light-yellow) 100%);
            color: var(--text-dark);
            min-height: 100vh;
        }

        .form-container {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 248, 220, 0.9) 100%);
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem auto;
            max-width: 1000px;
            box-shadow: 0 10px 30px var(--shadow-soft);
            border: 1px solid rgba(255, 215, 0, 0.2);
        }

        .form-header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 3px solid var(--primary-orange);
        }

        .form-header h1 {
            color: var(--primary-deep-orange);
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .step-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .step {
            display: flex;
            align-items: center;
            margin: 0.5rem;
        }

        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e0e0e0;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-right: 0.5rem;
            transition: all 0.3s ease;
        }

        .step.active .step-circle {
            background: var(--primary-orange);
        }

        .step.completed .step-circle {
            background: var(--success-green);
        }

        .step-label {
            font-weight: 500;
            color: #999;
        }

        .step.active .step-label {
            color: var(--text-dark);
        }

        .form-section {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .form-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-control, .form-select {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 0.75rem;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-orange);
            box-shadow: 0 0 0 0.2rem rgba(255, 165, 0, 0.25);
        }

        .form-label {
            font-weight: 600;
            color: var(--text-brown);
            margin-bottom: 0.5rem;
        }

        .required::after {
            content: " *";
            color: var(--danger-red);
        }

        #locationMap {
            height: 300px;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
            margin-top: 1rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-orange) 0%, var(--primary-deep-orange) 100%);
            border: none;
            border-radius: 10px;
            padding: 0.75rem 2rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 140, 0, 0.4);
        }

        .btn-secondary {
            background: #e0e0e0;
            color: var(--text-dark);
            border: none;
            border-radius: 10px;
            padding: 0.75rem 2rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: #d0d0d0;
            transform: translateY(-2px);
        }

        .preview-section {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            padding: 1.5rem;
            margin-top: 1rem;
            border: 2px dashed var(--primary-orange);
        }

        .preview-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid #eee;
        }

        .preview-label {
            font-weight: 600;
            color: var(--text-brown);
        }

        .initial-stock-item {
            background: var(--bg-light-yellow);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .error-text {
            color: var(--danger-red);
            font-size: 0.875rem;
            margin-top: 0.25rem;
            display: none;
        }

        .success-message {
            background: rgba(50, 205, 50, 0.1);
            border: 2px solid var(--success-green);
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
            text-align: center;
            color: var(--success-green);
            display: none;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .loading-overlay.show {
            display: flex;
        }

        .branch-type-card {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .branch-type-card:hover {
            border-color: var(--primary-orange);
            background: var(--bg-light-yellow);
        }

        .branch-type-card.selected {
            border-color: var(--primary-orange);
            background: var(--bg-light-yellow);
        }
    </style>
</head>
<body>
    <div class="form-container">
        <div class="form-header">
            <h1><i class="fas fa-store-alt me-2"></i>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏´‡∏°‡πà</h1>
            <p class="text-muted">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>
        </div>

        <!-- Step Indicator -->
        <div class="step-indicator">
            <div class="step active" id="step1">
                <div class="step-circle">1</div>
                <div class="step-label">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</div>
            </div>
            <div class="step" id="step2">
                <div class="step-circle">2</div>
                <div class="step-label">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á</div>
            </div>
            <div class="step" id="step3">
                <div class="step-circle">3</div>
                <div class="step-label">‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏≤‡∏Ç‡∏≤</div>
            </div>
            <div class="step" id="step4">
                <div class="step-circle">4</div>
                <div class="step-label">‡∏™‡∏ï‡πä‡∏≠‡∏Ñ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</div>
            </div>
            <div class="step" id="step5">
                <div class="step-circle">5</div>
                <div class="step-label">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>
            </div>
        </div>

        <form id="addBranchForm">
            <!-- Step 1: Basic Information -->
            <div class="form-section active" id="section1">
                <h3 class="mb-4"><i class="fas fa-info-circle me-2"></i>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏™‡∏≤‡∏Ç‡∏≤</h3>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label required">‡∏£‡∏´‡∏±‡∏™‡∏™‡∏≤‡∏Ç‡∏≤</label>
                        <input type="text" class="form-control" id="branchId" readonly>
                        <small class="text-muted">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏´‡∏±‡∏™‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</small>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label required">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏Ç‡∏≤</label>
                        <input type="text" class="form-control" id="branchName" required>
                        <span class="error-text">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏Ç‡∏≤</span>
                    </div>
                </div>

                <div class="mb-4">
                    <label class="form-label required">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏≤‡∏Ç‡∏≤</label>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="branch-type-card" onclick="selectBranchType('STANDARD')">
                                <h5><i class="fas fa-store me-2"></i>Standard</h5>
                                <p class="mb-0 text-muted">‡∏™‡∏≤‡∏Ç‡∏≤‡∏Ç‡∏ô‡∏≤‡∏î‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="branch-type-card" onclick="selectBranchType('EXPRESS')">
                                <h5><i class="fas fa-rocket me-2"></i>Express</h5>
                                <p class="mb-0 text-muted">‡∏™‡∏≤‡∏Ç‡∏≤‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å ‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÄ‡∏£‡πá‡∏ß</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="branch-type-card" onclick="selectBranchType('FLAGSHIP')">
                                <h5><i class="fas fa-crown me-2"></i>Flagship</h5>
                                <p class="mb-0 text-muted">‡∏™‡∏≤‡∏Ç‡∏≤‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà</p>
                            </div>
                        </div>
                    </div>
                    <input type="hidden" id="branchType" required>
                    <span class="error-text">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏≤‡∏Ç‡∏≤</span>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label required">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                        <input type="tel" class="form-control" id="branchPhone" required>
                        <span class="error-text">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</span>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                        <input type="email" class="form-control" id="branchEmail">
                    </div>
                </div>

                <div class="d-flex justify-content-end mt-4">
                    <button type="button" class="btn btn-primary" onclick="nextStep(1)">
                        ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ <i class="fas fa-arrow-right ms-2"></i>
                    </button>
                </div>
            </div>

            <!-- Step 2: Location -->
            <div class="form-section" id="section2">
                <h3 class="mb-4"><i class="fas fa-map-marked-alt me-2"></i>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡∏™‡∏≤‡∏Ç‡∏≤</h3>
                
                <div class="mb-3">
                    <label class="form-label required">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</label>
                    <textarea class="form-control" id="branchAddress" rows="3" required></textarea>
                    <span class="error-text">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</span>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label required">‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</label>
                        <select class="form-select" id="branchProvince" required>
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</option>
                            <option value="bangkok">‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£</option>
                            <option value="chiangmai">‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà</option>
                            <option value="phuket">‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï</option>
                            <option value="khonkaen">‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô</option>
                            <option value="songkhla">‡∏™‡∏á‡∏Ç‡∏•‡∏≤</option>
                        </select>
                        <span class="error-text">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</span>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label required">‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå</label>
                        <input type="text" class="form-control" id="branchPostcode" maxlength="5" required>
                        <span class="error-text">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå</span>
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà</label>
                    <div id="locationMap"></div>
                    <div class="row mt-2">
                        <div class="col-md-6">
                            <input type="text" class="form-control" id="branchLat" placeholder="Latitude" readonly>
                        </div>
                        <div class="col-md-6">
                            <input type="text" class="form-control" id="branchLng" placeholder="Longitude" readonly>
                        </div>
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label required">‡πÇ‡∏ã‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</label>
                    <select class="form-select" id="deliveryZone" required>
                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ã‡∏ô</option>
                        <option value="ZONE_NORTH">‡∏†‡∏≤‡∏Ñ‡πÄ‡∏´‡∏ô‡∏∑‡∏≠</option>
                        <option value="ZONE_NORTHEAST">‡∏†‡∏≤‡∏Ñ‡∏≠‡∏µ‡∏™‡∏≤‡∏ô</option>
                        <option value="ZONE_CENTRAL">‡∏†‡∏≤‡∏Ñ‡∏Å‡∏•‡∏≤‡∏á</option>
                        <option value="ZONE_EAST">‡∏†‡∏≤‡∏Ñ‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å</option>
                        <option value="ZONE_WEST">‡∏†‡∏≤‡∏Ñ‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏ï‡∏Å</option>
                        <option value="ZONE_SOUTH">‡∏†‡∏≤‡∏Ñ‡πÉ‡∏ï‡πâ</option>
                    </select>
                    <span class="error-text">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ã‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</span>
                </div>

                <div class="d-flex justify-content-between mt-4">
                    <button type="button" class="btn btn-secondary" onclick="prevStep(2)">
                        <i class="fas fa-arrow-left me-2"></i>‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö
                    </button>
                    <button type="button" class="btn btn-primary" onclick="nextStep(2)">
                        ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ <i class="fas fa-arrow-right ms-2"></i>
                    </button>
                </div>
            </div>

            <!-- Step 3: Manager Information -->
            <div class="form-section" id="section3">
                <h3 class="mb-4"><i class="fas fa-user-tie me-2"></i>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏≤‡∏Ç‡∏≤</h3>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label required">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                        <input type="text" class="form-control" id="managerName" required>
                        <span class="error-text">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</span>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label required">‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô</label>
                        <input type="text" class="form-control" id="managerId" maxlength="13" required>
                        <span class="error-text">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô 13 ‡∏´‡∏•‡∏±‡∏Å</span>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label required">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                        <input type="tel" class="form-control" id="managerPhone" required>
                        <span class="error-text">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</span>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label required">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                        <input type="email" class="form-control" id="managerEmail" required>
                        <span class="error-text">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</span>
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label">‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</label>
                    <textarea class="form-control" id="managerExperience" rows="3" 
                        placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á..."></textarea>
                </div>

                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á User Account ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
                </div>

                <div class="d-flex justify-content-between mt-4">
                    <button type="button" class="btn btn-secondary" onclick="prevStep(3)">
                        <i class="fas fa-arrow-left me-2"></i>‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö
                    </button>
                    <button type="button" class="btn btn-primary" onclick="nextStep(3)">
                        ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ <i class="fas fa-arrow-right ms-2"></i>
                    </button>
                </div>
            </div>

            <!-- Step 4: Initial Stock -->
            <div class="form-section" id="section4">
                <h3 class="mb-4"><i class="fas fa-boxes me-2"></i>‡∏™‡∏ï‡πä‡∏≠‡∏Ñ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</h3>
                
                <div class="mb-3">
                    <label class="form-label">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï‡∏™‡∏ï‡πä‡∏≠‡∏Ñ</label>
                    <select class="form-select" id="stockTemplate" onchange="applyStockTemplate()">
                        <option value="">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á</option>
                        <option value="standard">Standard Branch (‡∏™‡∏≤‡∏Ç‡∏≤‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô)</option>
                        <option value="express">Express Branch (‡∏™‡∏≤‡∏Ç‡∏≤‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å)</option>
                        <option value="flagship">Flagship Branch (‡∏™‡∏≤‡∏Ç‡∏≤‡∏´‡∏•‡∏±‡∏Å)</option>
                    </select>
                </div>

                <div id="stockItems">
                    <div class="initial-stock-item">
                        <div>
                            <strong>‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á‡∏≠‡∏ö‡πÅ‡∏´‡πâ‡∏á Premium</strong>
                            <br><small class="text-muted">DF-MANGO-001</small>
                        </div>
                        <div class="d-flex align-items-center">
                            <input type="number" class="form-control me-2" style="width: 100px" 
                                id="stock_mango" value="10" min="0">
                            <span>kg</span>
                        </div>
                    </div>
                    <div class="initial-stock-item">
                        <div>
                            <strong>‡∏™‡∏±‡∏ö‡∏õ‡∏∞‡∏£‡∏î‡∏≠‡∏ö‡πÅ‡∏´‡πâ‡∏á</strong>
                            <br><small class="text-muted">DF-PINE-001</small>
                        </div>
                        <div class="d-flex align-items-center">
                            <input type="number" class="form-control me-2" style="width: 100px" 
                                id="stock_pineapple" value="15" min="0">
                            <span>kg</span>
                        </div>
                    </div>
                    <div class="initial-stock-item">
                        <div>
                            <strong>‡∏Å‡∏•‡πâ‡∏ß‡∏¢‡∏≠‡∏ö‡πÅ‡∏´‡πâ‡∏á</strong>
                            <br><small class="text-muted">DF-BANANA-001</small>
                        </div>
                        <div class="d-flex align-items-center">
                            <input type="number" class="form-control me-2" style="width: 100px" 
                                id="stock_banana" value="8" min="0">
                            <span>kg</span>
                        </div>
                    </div>
                    <div class="initial-stock-item">
                        <div>
                            <strong>‡∏•‡∏≥‡πÑ‡∏¢‡∏≠‡∏ö‡πÅ‡∏´‡πâ‡∏á</strong>
                            <br><small class="text-muted">DF-LONGAN-001</small>
                        </div>
                        <div class="d-flex align-items-center">
                            <input type="number" class="form-control me-2" style="width: 100px" 
                                id="stock_longan" value="5" min="0">
                            <span>kg</span>
                        </div>
                    </div>
                    <div class="initial-stock-item">
                        <div>
                            <strong>‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏£‡∏ß‡∏° Premium</strong>
                            <br><small class="text-muted">DF-MIXED-001</small>
                        </div>
                        <div class="d-flex align-items-center">
                            <input type="number" class="form-control me-2" style="width: 100px" 
                                id="stock_mixed" value="12" min="0">
                            <span>kg</span>
                        </div>
                    </div>
                </div>

                <div class="alert alert-warning mt-3">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    ‡∏™‡∏ï‡πä‡∏≠‡∏Ñ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏™‡∏≤‡∏Ç‡∏≤
                </div>

                <div class="d-flex justify-content-between mt-4">
                    <button type="button" class="btn btn-secondary" onclick="prevStep(4)">
                        <i class="fas fa-arrow-left me-2"></i>‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö
                    </button>
                    <button type="button" class="btn btn-primary" onclick="nextStep(4)">
                        ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ <i class="fas fa-arrow-right ms-2"></i>
                    </button>
                </div>
            </div>

            <!-- Step 5: Review -->
            <div class="form-section" id="section5">
                <h3 class="mb-4"><i class="fas fa-check-circle me-2"></i>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
                
                <div class="preview-section">
                    <h5 class="mb-3 text-primary">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏´‡∏°‡πà</h5>
                    <div id="previewContent">
                        <!-- Preview content will be generated dynamically -->
                    </div>
                </div>

                <div class="form-check mt-4">
                    <input class="form-check-input" type="checkbox" id="confirmData">
                    <label class="form-check-label" for="confirmData">
                        ‡∏Ç‡πâ‡∏≤‡∏û‡πÄ‡∏à‡πâ‡∏≤‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                    </label>
                </div>

                <div class="success-message" id="successMessage">
                    <i class="fas fa-check-circle fa-3x mb-3"></i>
                    <h4>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h4>
                    <p>‡∏£‡∏´‡∏±‡∏™‡∏™‡∏≤‡∏Ç‡∏≤: <strong id="newBranchId"></strong></p>
                    <p>‡∏™‡∏≤‡∏Ç‡∏≤‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>
                </div>

                <div class="d-flex justify-content-between mt-4" id="reviewButtons">
                    <button type="button" class="btn btn-secondary" onclick="prevStep(5)">
                        <i class="fas fa-arrow-left me-2"></i>‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö
                    </button>
                    <button type="button" class="btn btn-primary" onclick="submitBranch()" id="submitButton">
                        <i class="fas fa-paper-plane me-2"></i>‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                    </button>
                </div>
            </div>
        </form>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="text-center">
            <div class="spinner-border text-warning" style="width: 3rem; height: 3rem;" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="text-white mt-3">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏´‡∏°‡πà...</p>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        let currentStep = 1;
        let locationMap;
        let marker;
        let branchData = {};

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            generateBranchId();
        });

        // Generate Branch ID
        async function generateBranchId() {
            try {
                const response = await fetch('/api/branches/generate-id');
                const data = await response.json();
                document.getElementById('branchId').value = data.branchId || 'BR-001';
            } catch (error) {
                // Fallback ID
                document.getElementById('branchId').value = 'BR-' + Date.now().toString().slice(-3);
            }
        }

        // Step Navigation
        function nextStep(step) {
            if (validateStep(step)) {
                document.getElementById(`section${step}`).classList.remove('active');
                document.getElementById(`step${step}`).classList.add('completed');
                
                currentStep = step + 1;
                document.getElementById(`section${currentStep}`).classList.add('active');
                document.getElementById(`step${currentStep}`).classList.add('active');

                // Initialize map on step 2
                if (currentStep === 2 && !locationMap) {
                    initLocationMap();
                }

                // Generate preview on step 5
                if (currentStep === 5) {
                    generatePreview();
                }
            }
        }

        function prevStep(step) {
            document.getElementById(`section${step}`).classList.remove('active');
            document.getElementById(`step${step}`).classList.remove('active');
            
            currentStep = step - 1;
            document.getElementById(`section${currentStep}`).classList.add('active');
        }

        // Validation
        function validateStep(step) {
            let isValid = true;
            const section = document.getElementById(`section${step}`);
            const inputs = section.querySelectorAll('[required]');
            
            inputs.forEach(input => {
                if (!input.value.trim()) {
                    input.classList.add('is-invalid');
                    input.nextElementSibling.style.display = 'block';
                    isValid = false;
                } else {
                    input.classList.remove('is-invalid');
                    input.nextElementSibling.style.display = 'none';
                }
            });

            // Special validations
            if (step === 1 && !document.getElementById('branchType').value) {
                document.querySelector('#section1 .error-text:last-child').style.display = 'block';
                isValid = false;
            }

            if (step === 3) {
                const managerId = document.getElementById('managerId').value;
                if (managerId.length !== 13 || !/^\d+$/.test(managerId)) {
                    document.getElementById('managerId').classList.add('is-invalid');
                    isValid = false;
                }

                const email = document.getElementById('managerEmail').value;
                if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                    document.getElementById('managerEmail').classList.add('is-invalid');
                    isValid = false;
                }
            }

            return isValid;
        }

        // Branch Type Selection
        function selectBranchType(type) {
            document.querySelectorAll('.branch-type-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            document.getElementById('branchType').value = type;
            
            // Auto-apply stock template
            if (currentStep > 3) {
                document.getElementById('stockTemplate').value = type.toLowerCase();
                applyStockTemplate();
            }
        }

        // Initialize Location Map
        function initLocationMap() {
            locationMap = L.map('locationMap').setView([13.7563, 100.5018], 10);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(locationMap);

            // Add click event
            locationMap.on('click', function(e) {
                if (marker) {
                    locationMap.removeLayer(marker);
                }
                
                marker = L.marker(e.latlng).addTo(locationMap);
                document.getElementById('branchLat').value = e.latlng.lat.toFixed(6);
                document.getElementById('branchLng').value = e.latlng.lng.toFixed(6);
            });
        }

        // Apply Stock Template
        function applyStockTemplate() {
            const template = document.getElementById('stockTemplate').value;
            const stockValues = {
                standard: { mango: 10, pineapple: 15, banana: 8, longan: 5, mixed: 12 },
                express: { mango: 5, pineapple: 8, banana: 5, longan: 3, mixed: 6 },
                flagship: { mango: 20, pineapple: 30, banana: 15, longan: 10, mixed: 25 }
            };

            if (stockValues[template]) {
                document.getElementById('stock_mango').value = stockValues[template].mango;
                document.getElementById('stock_pineapple').value = stockValues[template].pineapple;
                document.getElementById('stock_banana').value = stockValues[template].banana;
                document.getElementById('stock_longan').value = stockValues[template].longan;
                document.getElementById('stock_mixed').value = stockValues[template].mixed;
            }
        }

        // Generate Preview
        function generatePreview() {
            const data = {
                branchId: document.getElementById('branchId').value,
                branchName: document.getElementById('branchName').value,
                branchType: document.getElementById('branchType').value,
                branchPhone: document.getElementById('branchPhone').value,
                branchEmail: document.getElementById('branchEmail').value,
                branchAddress: document.getElementById('branchAddress').value,
                branchProvince: document.getElementById('branchProvince').selectedOptions[0]?.text,
                branchPostcode: document.getElementById('branchPostcode').value,
                deliveryZone: document.getElementById('deliveryZone').selectedOptions[0]?.text,
                lat: document.getElementById('branchLat').value,
                lng: document.getElementById('branchLng').value,
                managerName: document.getElementById('managerName').value,
                managerPhone: document.getElementById('managerPhone').value,
                managerEmail: document.getElementById('managerEmail').value,
                stockMango: document.getElementById('stock_mango').value,
                stockPineapple: document.getElementById('stock_pineapple').value,
                stockBanana: document.getElementById('stock_banana').value,
                stockLongan: document.getElementById('stock_longan').value,
                stockMixed: document.getElementById('stock_mixed').value
            };

            branchData = data;

            const previewHTML = `
                <div class="preview-item">
                    <span class="preview-label">‡∏£‡∏´‡∏±‡∏™‡∏™‡∏≤‡∏Ç‡∏≤:</span>
                    <span>${data.branchId}</span>
                </div>
                <div class="preview-item">
                    <span class="preview-label">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏Ç‡∏≤:</span>
                    <span>${data.branchName}</span>
                </div>
                <div class="preview-item">
                    <span class="preview-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:</span>
                    <span>${data.branchType}</span>
                </div>
                <div class="preview-item">
                    <span class="preview-label">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</span>
                    <span>${data.branchAddress}, ${data.branchProvince} ${data.branchPostcode}</span>
                </div>
                <div class="preview-item">
                    <span class="preview-label">‡πÇ‡∏ã‡∏ô‡∏à‡∏±‡∏î‡∏™‡πà‡∏á:</span>
                    <span>${data.deliveryZone}</span>
                </div>
                <div class="preview-item">
                    <span class="preview-label">‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£:</span>
                    <span>${data.managerName} (${data.managerPhone})</span>
                </div>
                <div class="preview-item">
                    <span class="preview-label">‡∏™‡∏ï‡πä‡∏≠‡∏Ñ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô:</span>
                    <span>‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á ${data.stockMango}kg, ‡∏™‡∏±‡∏ö‡∏õ‡∏∞‡∏£‡∏î ${data.stockPineapple}kg, ‡∏Å‡∏•‡πâ‡∏ß‡∏¢ ${data.stockBanana}kg</span>
                </div>
            `;

            document.getElementById('previewContent').innerHTML = previewHTML;
        }

        // Submit Branch
        async function submitBranch() {
            if (!document.getElementById('confirmData').checked) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');
                return;
            }

            document.getElementById('loadingOverlay').classList.add('show');
            document.getElementById('submitButton').disabled = true;

            try {
                const response = await fetch('/api/branches', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(branchData)
                });

                const result = await response.json();

                if (result.success) {
                    document.getElementById('newBranchId').textContent = result.data.branchId;
                    document.getElementById('successMessage').style.display = 'block';
                    document.getElementById('reviewButtons').style.display = 'none';
                    
                    // Auto-start setup process
                    setTimeout(() => {
                        startAutoSetup(result.data.branchId);
                    }, 2000);
                    
                    // Send notification
                    sendNotification(result.data);
                } else {
                    throw new Error(result.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏≤‡∏Ç‡∏≤');
                }
            } catch (error) {
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
                document.getElementById('submitButton').disabled = false;
            } finally {
                document.getElementById('loadingOverlay').classList.remove('show');
            }
        }

        // Start auto setup process
        function startAutoSetup(branchId) {
            const setupUrl = `/auto-branch-setup?id=${branchId}&name=${encodeURIComponent(branchData.branchName)}&manager=${encodeURIComponent(branchData.managerName)}&lat=${branchData.lat}&lng=${branchData.lng}&province=${encodeURIComponent(branchData.branchProvince)}`;
            window.open(setupUrl, '_blank', 'width=1000,height=700');
        }

        // Send Notification
        function sendNotification(branchData) {
            // In real implementation, send to Line or notification system
            console.log('Sending notification for new branch:', branchData);
        }

        // Input event listeners
        document.querySelectorAll('input, select, textarea').forEach(element => {
            element.addEventListener('blur', function() {
                if (this.required && !this.value.trim()) {
                    this.classList.add('is-invalid');
                } else {
                    this.classList.remove('is-invalid');
                }
            });
        });
    </script>
</body>
</html>