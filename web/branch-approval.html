<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏´‡∏°‡πà - ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πä‡∏≠‡∏Ñ‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏≠‡∏ö‡πÅ‡∏´‡πâ‡∏á</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ü•≠</text></svg>">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-gold: #FFD700;
            --primary-orange: #FFA500;
            --primary-deep-orange: #FF8C00;
            --bg-cream: #FFF8DC;
            --bg-light-yellow: #FFFACD;
            --bg-warm-white: #FEFEF7;
            --text-dark: #2C1810;
            --text-brown: #8B4513;
            --success-green: #32CD32;
            --warning-amber: #FFBF00;
            --danger-red: #FF6B6B;
            --shadow-warm: rgba(255, 165, 0, 0.15);
            --shadow-soft: rgba(0, 0, 0, 0.08);
        }

        body {
            font-family: 'Prompt', sans-serif;
            background: linear-gradient(135deg, var(--bg-cream) 0%, var(--bg-light-yellow) 100%);
            color: var(--text-dark);
            min-height: 100vh;
        }

        .navbar {
            background: linear-gradient(135deg, var(--primary-gold) 0%, var(--primary-orange) 100%);
            padding: 1rem 0;
            box-shadow: 0 4px 20px var(--shadow-warm);
        }

        .navbar-brand {
            font-weight: 700;
            font-size: 1.5rem;
            color: var(--text-dark) !important;
        }

        .approval-container {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 248, 220, 0.8) 100%);
            border-radius: 20px;
            padding: 2rem;
            margin: 1.5rem 0;
            box-shadow: 0 5px 15px var(--shadow-soft);
            border: 1px solid rgba(255, 215, 0, 0.2);
        }

        .pending-badge {
            background: linear-gradient(135deg, var(--warning-amber) 0%, #FFD700 100%);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.875rem;
            display: inline-flex;
            align-items: center;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .approval-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 3px 10px var(--shadow-soft);
            border-left: 4px solid var(--warning-amber);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .approval-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--warning-amber) 0%, var(--primary-gold) 100%);
        }

        .approval-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px var(--shadow-soft);
        }

        .approval-header {
            display: flex;
            justify-content: between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .branch-info {
            flex: 1;
        }

        .approval-actions {
            display: flex;
            gap: 0.5rem;
            align-items: flex-start;
        }

        .btn-approve {
            background: linear-gradient(135deg, var(--success-green) 0%, #28a745 100%);
            border: none;
            color: white;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-approve:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(50, 205, 50, 0.4);
        }

        .btn-reject {
            background: linear-gradient(135deg, var(--danger-red) 0%, #dc3545 100%);
            border: none;
            color: white;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-reject:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.4);
        }

        .btn-view {
            background: linear-gradient(135deg, var(--primary-orange) 0%, var(--primary-deep-orange) 100%);
            border: none;
            color: white;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-view:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 165, 0, 0.4);
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .info-item {
            background: var(--bg-light-yellow);
            padding: 0.75rem;
            border-radius: 8px;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }

        .info-label {
            font-weight: 600;
            color: var(--text-brown);
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
        }

        .info-value {
            color: var(--text-dark);
            font-weight: 500;
        }

        .timeline-container {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 3px 10px var(--shadow-soft);
        }

        .timeline-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid #eee;
            position: relative;
        }

        .timeline-item:last-child {
            border-bottom: none;
        }

        .timeline-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-orange);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            font-weight: 600;
        }

        .timeline-content {
            flex: 1;
        }

        .timeline-time {
            color: #666;
            font-size: 0.875rem;
            margin-left: auto;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 3px 10px var(--shadow-soft);
            border: 1px solid rgba(255, 215, 0, 0.2);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px var(--shadow-soft);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-brown);
            font-weight: 500;
            font-size: 0.875rem;
        }

        .approval-modal .modal-content {
            border-radius: 20px;
            border: none;
            box-shadow: 0 10px 30px var(--shadow-soft);
        }

        .approval-modal .modal-header {
            background: linear-gradient(135deg, var(--primary-gold) 0%, var(--primary-orange) 100%);
            border-radius: 20px 20px 0 0;
            border-bottom: none;
        }

        .priority-high {
            border-left-color: var(--danger-red);
        }

        .priority-medium {
            border-left-color: var(--warning-amber);
        }

        .priority-low {
            border-left-color: var(--success-green);
        }

        .filter-tab {
            background: transparent;
            border: 2px solid var(--primary-orange);
            color: var(--primary-orange);
            border-radius: 20px;
            padding: 0.5rem 1rem;
            margin-right: 0.5rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .filter-tab.active,
        .filter-tab:hover {
            background: var(--primary-orange);
            color: white;
        }

        .urgent-indicator {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 20px;
            height: 20px;
            background: var(--danger-red);
            border-radius: 50%;
            animation: ping 1s infinite;
        }

        @keyframes ping {
            75%, 100% {
                transform: scale(2);
                opacity: 0;
            }
        }

        .bulk-actions {
            background: var(--bg-light-yellow);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 2px dashed var(--primary-orange);
            display: none;
        }

        .bulk-actions.show {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="/branch-management">
                <i class="fas fa-arrow-left me-2"></i>‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏´‡∏°‡πà
            </a>
            <div class="d-flex align-items-center">
                <span class="pending-badge me-3">
                    <i class="fas fa-clock me-1"></i>
                    <span id="pendingCount">3</span> ‡∏™‡∏≤‡∏Ç‡∏≤‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                </span>
                <button class="btn btn-outline-light" onclick="refreshData()">
                    <i class="fas fa-sync-alt me-1"></i>‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mt-3">
        <!-- Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value text-warning" id="totalPending">3</div>
                <div class="stat-label">‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</div>
            </div>
            <div class="stat-card">
                <div class="stat-value text-success" id="approvedToday">12</div>
                <div class="stat-label">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
            </div>
            <div class="stat-card">
                <div class="stat-value text-danger" id="rejectedToday">1</div>
                <div class="stat-label">‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
            </div>
            <div class="stat-card">
                <div class="stat-value text-info" id="avgApprovalTime">2.5</div>
                <div class="stat-label">‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á (‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢)</div>
            </div>
        </div>

        <!-- Filter Tabs -->
        <div class="mb-3">
            <button class="filter-tab active" onclick="filterByPriority('all')">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
            <button class="filter-tab" onclick="filterByPriority('urgent')">‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô</button>
            <button class="filter-tab" onclick="filterByPriority('high')">‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</button>
            <button class="filter-tab" onclick="filterByPriority('medium')">‡∏õ‡∏Å‡∏ï‡∏¥</button>
        </div>

        <!-- Bulk Actions -->
        <div class="bulk-actions" id="bulkActions">
            <div class="d-flex justify-content-between align-items-center">
                <span><strong id="selectedCount">0</strong> ‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</span>
                <div>
                    <button class="btn btn-sm btn-approve me-2" onclick="bulkApprove()">
                        <i class="fas fa-check me-1"></i>‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                    </button>
                    <button class="btn btn-sm btn-reject" onclick="bulkReject()">
                        <i class="fas fa-times me-1"></i>‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                    </button>
                </div>
            </div>
        </div>

        <!-- Pending Approvals -->
        <div id="approvalsList">
            <!-- Approval cards will be dynamically loaded here -->
        </div>

        <!-- Recent Activities Timeline -->
        <div class="timeline-container">
            <h5 class="mb-3"><i class="fas fa-history me-2"></i>‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h5>
            <div id="activityTimeline">
                <div class="timeline-item">
                    <div class="timeline-icon">
                        <i class="fas fa-check"></i>
                    </div>
                    <div class="timeline-content">
                        <strong>‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏≤‡∏Ç‡∏≤‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô ‡πÄ‡∏ã‡πá‡∏ô‡∏ó‡∏£‡∏±‡∏•‡∏û‡∏•‡∏≤‡∏ã‡πà‡∏≤</strong>
                        <div class="text-muted">‡πÇ‡∏î‡∏¢ Admin ‡∏´‡∏•‡∏±‡∏Å</div>
                    </div>
                    <div class="timeline-time">15 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß</div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-icon">
                        <i class="fas fa-plus"></i>
                    </div>
                    <div class="timeline-content">
                        <strong>‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥: ‡∏™‡∏≤‡∏Ç‡∏≤‡∏´‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà</strong>
                        <div class="text-muted">‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£</div>
                    </div>
                    <div class="timeline-time">1 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß</div>
                </div>
                <div class="timeline-item">
                    <div class="timeline-icon">
                        <i class="fas fa-times"></i>
                    </div>
                    <div class="timeline-content">
                        <strong>‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏™‡∏≤‡∏Ç‡∏≤‡∏≠‡∏∏‡∏ö‡∏•‡∏£‡∏≤‡∏ä‡∏ò‡∏≤‡∏ô‡∏µ</strong>
                        <div class="text-muted">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô</div>
                    </div>
                    <div class="timeline-time">3 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Approval Modal -->
    <div class="modal fade approval-modal" id="approvalModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-dark">
                        <i class="fas fa-clipboard-check me-2"></i>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="modalContent">
                        <!-- Modal content will be dynamically loaded -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">‡∏õ‡∏¥‡∏î</button>
                    <button type="button" class="btn btn-reject me-2" onclick="modalReject()">
                        <i class="fas fa-times me-1"></i>‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò
                    </button>
                    <button type="button" class="btn btn-approve" onclick="modalApprove()">
                        <i class="fas fa-check me-1"></i>‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Rejection Reason Modal -->
    <div class="modal fade" id="rejectionModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-exclamation-triangle me-2"></i>‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò:</label>
                        <textarea class="form-control" id="rejectionReason" rows="4" 
                            placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô, ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°, ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô..."></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö):</label>
                        <textarea class="form-control" id="rejectionSuggestion" rows="3" 
                            placeholder="‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button type="button" class="btn btn-danger" onclick="confirmRejection()">
                        <i class="fas fa-times me-1"></i>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let pendingBranches = [];
        let selectedBranches = [];
        let currentBranchForApproval = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadPendingBranches();
            
            // Auto refresh every 30 seconds
            setInterval(refreshData, 30000);
        });

        // Load pending branches
        async function loadPendingBranches() {
            try {
                // In real implementation, fetch from API
                // const response = await fetch('/api/branches?status=PENDING');
                // const data = await response.json();
                
                // Mock data for demo
                pendingBranches = [
                    {
                        id: "BR-005",
                        name: "‡∏™‡∏≤‡∏Ç‡∏≤‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô ‡πÄ‡∏ã‡πá‡∏ô‡∏ó‡∏£‡∏±‡∏•‡∏û‡∏•‡∏≤‡∏ã‡πà‡∏≤",
                        type: "STANDARD",
                        address: "‡πÄ‡∏ã‡πá‡∏ô‡∏ó‡∏£‡∏±‡∏•‡∏û‡∏•‡∏≤‡∏ã‡πà‡∏≤‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô ‡∏ä‡∏±‡πâ‡∏ô 1 ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà 1/1 ‡∏ñ‡∏ô‡∏ô‡∏®‡∏£‡∏µ‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå ‡∏ï‡∏≥‡∏ö‡∏•‡πÉ‡∏ô‡πÄ‡∏°‡∏∑‡∏≠‡∏á ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô ‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô 40000",
                        manager: "‡∏ô‡∏≤‡∏á‡∏ß‡∏¥‡πÑ‡∏•‡∏ß‡∏£‡∏£‡∏ì ‡∏™‡∏∏‡∏Ç‡πÉ‡∏™",
                        managerPhone: "081-999-8888",
                        submittedDate: "2024-07-10T09:00:00Z",
                        priority: "high",
                        estimatedRevenue: 500000,
                        estimatedCost: 250000,
                        competition: "‡∏™‡∏π‡∏á",
                        marketPotential: "‡∏î‡∏µ",
                        urgentReason: "‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏™‡∏π‡∏á ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏π‡πà‡πÅ‡∏Ç‡πà‡∏á"
                    },
                    {
                        id: "BR-006",
                        name: "‡∏™‡∏≤‡∏Ç‡∏≤‡∏™‡∏á‡∏Ç‡∏•‡∏≤ ‡∏´‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà",
                        type: "STANDARD",
                        address: "‡∏ñ‡∏ô‡∏ô‡∏ô‡∏¥‡∏û‡∏±‡∏ó‡∏ò‡πå‡∏≠‡∏∏‡∏ó‡∏¥‡∏® 3 ‡∏ï‡∏≥‡∏ö‡∏•‡∏´‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏´‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà ‡∏™‡∏á‡∏Ç‡∏•‡∏≤ 90110",
                        manager: "‡∏ô‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡πÄ‡∏™‡∏£‡∏¥‡∏ê ‡∏£‡∏±‡∏Å‡∏î‡∏µ",
                        managerPhone: "086-777-6666",
                        submittedDate: "2024-07-15T09:00:00Z",
                        priority: "medium",
                        estimatedRevenue: 400000,
                        estimatedCost: 200000,
                        competition: "‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á",
                        marketPotential: "‡∏î‡∏µ",
                        urgentReason: null
                    },
                    {
                        id: "BR-007", 
                        name: "‡∏™‡∏≤‡∏Ç‡∏≤‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï ‡∏õ‡πà‡∏≤‡∏ï‡∏≠‡∏á Express",
                        type: "EXPRESS",
                        address: "‡∏ñ‡∏ô‡∏ô‡∏ö‡∏≤‡∏á‡∏•‡∏≤ ‡∏ï‡∏≥‡∏ö‡∏•‡∏õ‡πà‡∏≤‡∏ï‡∏≠‡∏á ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏Å‡∏∞‡∏ó‡∏π‡πâ ‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï 83150",
                        manager: "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏®‡∏¥‡∏£‡∏¥‡∏û‡∏£ ‡πÉ‡∏™‡πÉ‡∏™",
                        managerPhone: "087-111-2222",
                        submittedDate: "2024-07-18T09:00:00Z",
                        priority: "urgent",
                        estimatedRevenue: 300000,
                        estimatedCost: 150000,
                        competition: "‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å",
                        marketPotential: "‡∏î‡∏µ‡∏°‡∏≤‡∏Å",
                        urgentReason: "‡∏§‡∏î‡∏π‡∏Å‡∏≤‡∏•‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏ó‡∏±‡∏ô‡∏ó‡∏µ"
                    }
                ];
                
                displayPendingBranches(pendingBranches);
                updateStatistics();
                
            } catch (error) {
                console.error('Error loading pending branches:', error);
            }
        }

        // Display pending branches
        function displayPendingBranches(branches) {
            const container = document.getElementById('approvalsList');
            container.innerHTML = '';

            branches.forEach(branch => {
                const priorityClass = `priority-${branch.priority}`;
                const isUrgent = branch.priority === 'urgent';
                const submittedTime = formatTimeAgo(branch.submittedDate);
                
                const branchCard = `
                    <div class="approval-card ${priorityClass}" data-branch-id="${branch.id}">
                        ${isUrgent ? '<div class="urgent-indicator"></div>' : ''}
                        <div class="approval-header">
                            <div class="branch-info">
                                <div class="d-flex align-items-center mb-2">
                                    <input type="checkbox" class="form-check-input me-2" 
                                        onchange="toggleBranchSelection('${branch.id}', this.checked)">
                                    <h5 class="mb-0 me-2">${branch.name}</h5>
                                    <span class="badge bg-${getPriorityColor(branch.priority)} ms-2">
                                        ${getPriorityText(branch.priority)}
                                    </span>
                                </div>
                                <p class="text-muted mb-2">
                                    <i class="fas fa-map-marker-alt me-1"></i>${branch.address}
                                </p>
                                <p class="mb-2">
                                    <i class="fas fa-user-tie me-1"></i>‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£: ${branch.manager} 
                                    <span class="ms-3"><i class="fas fa-phone me-1"></i>${branch.managerPhone}</span>
                                </p>
                                <small class="text-muted">‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥: ${submittedTime}</small>
                                ${branch.urgentReason ? `<div class="alert alert-warning alert-sm mt-2 mb-0"><i class="fas fa-exclamation-triangle me-1"></i>${branch.urgentReason}</div>` : ''}
                            </div>
                            <div class="approval-actions">
                                <button class="btn btn-view btn-sm" onclick="viewBranchDetails('${branch.id}')">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-approve btn-sm" onclick="showApprovalModal('${branch.id}')">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button class="btn btn-reject btn-sm" onclick="showRejectionModal('${branch.id}')">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="info-grid">
                            <div class="info-item">
                                <div class="info-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏≤‡∏Ç‡∏≤</div>
                                <div class="info-value">${branch.type}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏Ñ‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏ì‡πå</div>
                                <div class="info-value">‡∏ø${branch.estimatedRevenue.toLocaleString()}/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏Ñ‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏ì‡πå</div>
                                <div class="info-value">‡∏ø${branch.estimatedCost.toLocaleString()}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô</div>
                                <div class="info-value">${branch.competition}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">‡∏®‡∏±‡∏Å‡∏¢‡∏†‡∏≤‡∏û‡∏ï‡∏•‡∏≤‡∏î</div>
                                <div class="info-value">${branch.marketPotential}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">ROI ‡∏Ñ‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏ì‡πå</div>
                                <div class="info-value">${Math.round((branch.estimatedRevenue * 12 - branch.estimatedCost) / branch.estimatedCost * 100)}%</div>
                            </div>
                        </div>
                    </div>
                `;
                
                container.innerHTML += branchCard;
            });
        }

        // Helper functions
        function getPriorityColor(priority) {
            switch (priority) {
                case 'urgent': return 'danger';
                case 'high': return 'warning';
                case 'medium': return 'info';
                default: return 'secondary';
            }
        }

        function getPriorityText(priority) {
            switch (priority) {
                case 'urgent': return '‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô';
                case 'high': return '‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç';
                case 'medium': return '‡∏õ‡∏Å‡∏ï‡∏¥';
                default: return '‡∏ï‡πà‡∏≥';
            }
        }

        function formatTimeAgo(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffInHours = (now - date) / (1000 * 60 * 60);
            
            if (diffInHours < 1) {
                return Math.round(diffInHours * 60) + ' ‡∏ô‡∏≤‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß';
            } else if (diffInHours < 24) {
                return Math.round(diffInHours) + ' ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß';
            } else {
                return Math.round(diffInHours / 24) + ' ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß';
            }
        }

        // Filter functions
        function filterByPriority(priority) {
            // Update active tab
            document.querySelectorAll('.filter-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            // Filter branches
            let filtered = pendingBranches;
            if (priority !== 'all') {
                filtered = pendingBranches.filter(branch => branch.priority === priority);
            }

            displayPendingBranches(filtered);
        }

        // Selection functions
        function toggleBranchSelection(branchId, isSelected) {
            if (isSelected) {
                if (!selectedBranches.includes(branchId)) {
                    selectedBranches.push(branchId);
                }
            } else {
                selectedBranches = selectedBranches.filter(id => id !== branchId);
            }

            updateBulkActions();
        }

        function updateBulkActions() {
            const bulkActions = document.getElementById('bulkActions');
            const selectedCount = document.getElementById('selectedCount');
            
            selectedCount.textContent = selectedBranches.length;
            
            if (selectedBranches.length > 0) {
                bulkActions.classList.add('show');
            } else {
                bulkActions.classList.remove('show');
            }
        }

        // Approval functions
        function showApprovalModal(branchId) {
            currentBranchForApproval = branchId;
            const branch = pendingBranches.find(b => b.id === branchId);
            
            const modalContent = `
                <div class="text-center mb-3">
                    <i class="fas fa-check-circle fa-4x text-success"></i>
                    <h4 class="mt-3">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏≤‡∏Ç‡∏≤</h4>
                </div>
                <div class="alert alert-info">
                    <strong>‡∏™‡∏≤‡∏Ç‡∏≤:</strong> ${branch.name}<br>
                    <strong>‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£:</strong> ${branch.manager}<br>
                    <strong>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏Ñ‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏ì‡πå:</strong> ‡∏ø${branch.estimatedRevenue.toLocaleString()}/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
                </div>
                <p>‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞:</p>
                <ul>
                    <li>‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</li>
                    <li>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</li>
                    <li>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö Inventory ‡πÅ‡∏•‡∏∞ POS</li>
                    <li>‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</li>
                    <li>‡∏™‡πà‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á</li>
                </ul>
            `;
            
            document.getElementById('modalContent').innerHTML = modalContent;
            
            const modal = new bootstrap.Modal(document.getElementById('approvalModal'));
            modal.show();
        }

        function showRejectionModal(branchId) {
            currentBranchForApproval = branchId;
            const modal = new bootstrap.Modal(document.getElementById('rejectionModal'));
            modal.show();
        }

        async function modalApprove() {
            if (!currentBranchForApproval) return;

            try {
                // In real implementation, send approval request
                // await fetch(`/api/branches/${currentBranchForApproval}/approve`, { method: 'POST' });
                
                // Update UI
                removeBranchFromPending(currentBranchForApproval);
                
                // Close modal
                bootstrap.Modal.getInstance(document.getElementById('approvalModal')).hide();
                
                // Show success message
                showNotification('‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏≤‡∏Ç‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
                
                // Auto-launch setup
                const branch = pendingBranches.find(b => b.id === currentBranchForApproval);
                if (branch) {
                    setTimeout(() => {
                        const setupUrl = `/auto-branch-setup?id=${branch.id}&name=${encodeURIComponent(branch.name)}&manager=${encodeURIComponent(branch.manager)}`;
                        window.open(setupUrl, '_blank', 'width=1000,height=700');
                    }, 1000);
                }
                
                currentBranchForApproval = null;
                
            } catch (error) {
                showNotification('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥', 'error');
            }
        }

        function confirmRejection() {
            const reason = document.getElementById('rejectionReason').value.trim();
            const suggestion = document.getElementById('rejectionSuggestion').value.trim();
            
            if (!reason) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò');
                return;
            }

            // In real implementation, send rejection request
            // await fetch(`/api/branches/${currentBranchForApproval}/reject`, {
            //     method: 'POST',
            //     body: JSON.stringify({ reason, suggestion })
            // });

            // Update UI
            removeBranchFromPending(currentBranchForApproval);
            
            // Close modal
            bootstrap.Modal.getInstance(document.getElementById('rejectionModal')).hide();
            
            // Clear form
            document.getElementById('rejectionReason').value = '';
            document.getElementById('rejectionSuggestion').value = '';
            
            showNotification('‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏™‡∏≤‡∏Ç‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'warning');
            
            currentBranchForApproval = null;
        }

        // Bulk operations
        function bulkApprove() {
            if (selectedBranches.length === 0) return;
            
            if (confirm(`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ ${selectedBranches.length} ‡∏™‡∏≤‡∏Ç‡∏≤?`)) {
                selectedBranches.forEach(branchId => {
                    removeBranchFromPending(branchId);
                });
                
                selectedBranches = [];
                updateBulkActions();
                showNotification('‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
            }
        }

        function bulkReject() {
            if (selectedBranches.length === 0) return;
            
            const reason = prompt('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò:');
            if (reason) {
                selectedBranches.forEach(branchId => {
                    removeBranchFromPending(branchId);
                });
                
                selectedBranches = [];
                updateBulkActions();
                showNotification('‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'warning');
            }
        }

        // Utility functions
        function removeBranchFromPending(branchId) {
            pendingBranches = pendingBranches.filter(b => b.id !== branchId);
            displayPendingBranches(pendingBranches);
            updateStatistics();
        }

        function updateStatistics() {
            document.getElementById('totalPending').textContent = pendingBranches.length;
            document.getElementById('pendingCount').textContent = pendingBranches.length;
        }

        function viewBranchDetails(branchId) {
            window.open(`/branch-details?id=${branchId}`, '_blank');
        }

        function refreshData() {
            loadPendingBranches();
            showNotification('‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'info');
        }

        function showNotification(message, type) {
            // Simple notification - in real implementation, use toast library
            const alertClass = type === 'success' ? 'alert-success' : 
                             type === 'error' ? 'alert-danger' : 
                             type === 'warning' ? 'alert-warning' : 'alert-info';
            
            const notification = document.createElement('div');
            notification.className = `alert ${alertClass} alert-dismissible fade show position-fixed`;
            notification.style.top = '20px';
            notification.style.right = '20px';
            notification.style.zIndex = '9999';
            notification.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.appendChild(notification);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
    </script>
</body>
</html>