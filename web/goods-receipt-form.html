<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡∏á - ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πä‡∏≠‡∏Ñ‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏≠‡∏ö‡πÅ‡∏´‡πâ‡∏á</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ü•≠</text></svg>">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-gold: #FFD700;
            --primary-orange: #FFA500;
            --primary-deep-orange: #FF8C00;
            --bg-cream: #FFF8DC;
            --bg-light-yellow: #FFFACD;
            --bg-warm-white: #FEFEF7;
            --text-dark: #2C1810;
            --text-brown: #8B4513;
            --success-green: #32CD32;
            --warning-amber: #FFBF00;
            --danger-red: #FF6B6B;
            --shadow-warm: rgba(255, 165, 0, 0.15);
            --shadow-soft: rgba(0, 0, 0, 0.08);
        }

        body {
            font-family: 'Prompt', sans-serif;
            background: linear-gradient(135deg, var(--bg-cream) 0%, var(--bg-light-yellow) 100%);
            color: var(--text-dark);
            min-height: 100vh;
        }

        .navbar {
            background: linear-gradient(135deg, var(--primary-gold) 0%, var(--primary-orange) 100%);
            padding: 1rem 0;
            box-shadow: 0 4px 20px var(--shadow-warm);
        }

        .navbar-brand {
            font-weight: 700;
            font-size: 1.5rem;
            color: var(--text-dark) !important;
        }

        .form-container {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 248, 220, 0.8) 100%);
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem auto;
            max-width: 900px;
            box-shadow: 0 10px 30px var(--shadow-soft);
            border: 1px solid rgba(255, 215, 0, 0.2);
            backdrop-filter: blur(10px);
        }

        .form-header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--success-green);
        }

        .form-header h1 {
            color: var(--success-green);
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .form-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 15px;
            border-left: 4px solid var(--success-green);
        }

        .form-section h3 {
            color: var(--text-brown);
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .form-control {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 0.75rem;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            border-color: var(--success-green);
            box-shadow: 0 0 0 0.2rem rgba(50, 205, 50, 0.25);
        }

        .form-label {
            font-weight: 500;
            color: var(--text-brown);
            margin-bottom: 0.5rem;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success-green) 0%, #228B22 100%);
            border: none;
            padding: 15px 40px;
            border-radius: 25px;
            font-weight: 600;
            color: white;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(50, 205, 50, 0.3);
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(50, 205, 50, 0.4);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-orange) 0%, var(--primary-deep-orange) 100%);
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 140, 0, 0.3);
        }

        .comparison-table {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px var(--shadow-soft);
        }

        .table thead th {
            background: linear-gradient(135deg, var(--success-green) 0%, #228B22 100%);
            color: white;
            font-weight: 600;
            border: none;
            padding: 1rem;
        }

        .table tbody td {
            padding: 0.75rem;
            vertical-align: middle;
            border-color: rgba(50, 205, 50, 0.2);
        }

        .status-match {
            background-color: #D1F2D1 !important;
            color: #155724;
            font-weight: 600;
        }

        .status-short {
            background-color: #F8D7DA !important;
            color: #721C24;
            font-weight: 600;
        }

        .status-over {
            background-color: #CCE5FF !important;
            color: #004085;
            font-weight: 600;
        }

        .add-item-btn {
            width: 100%;
            padding: 0.75rem;
            background: linear-gradient(135deg, var(--success-green) 0%, #228B22 100%);
            border: none;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .summary-section {
            background: linear-gradient(135deg, var(--bg-cream) 0%, var(--bg-light-yellow) 100%);
            padding: 1.5rem;
            border-radius: 15px;
            margin-top: 2rem;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(50, 205, 50, 0.2);
        }

        .summary-item.highlight {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--success-green);
            border-bottom: 2px solid var(--success-green);
            padding-top: 1rem;
        }

        .preview-section {
            background: white;
            padding: 1.5rem;
            border-radius: 15px;
            border: 2px solid var(--success-green);
            margin-top: 2rem;
            display: none;
        }

        .remove-item-btn {
            background: var(--danger-red);
            border: none;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 5px;
            font-size: 0.875rem;
        }

        @media (max-width: 768px) {
            .form-container {
                margin: 1rem;
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-seedling"></i>
                ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πä‡∏≠‡∏Ñ‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏≠‡∏ö‡πÅ‡∏´‡πâ‡∏á
            </a>
            <div class="ms-auto">
                <a href="/" class="btn btn-outline-dark">
                    <i class="fas fa-arrow-left"></i> ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container">
        <div class="form-container">
            <div class="form-header">
                <h1>
                    <i class="fas fa-truck-loading"></i>
                    ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡∏á
                </h1>
                <p class="text-muted">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å‡∏ã‡∏±‡∏û‡∏û‡∏•‡∏≤‡∏¢‡πÄ‡∏≠‡∏≠‡∏£‡πå‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</p>
            </div>

            <form id="goodsReceiptForm">
                <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
                <div class="form-section">
                    <h3>
                        <i class="fas fa-info-circle"></i>
                        ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                    </h3>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
                                <input type="text" class="form-control" id="grNumber" readonly>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á</label>
                                <input type="text" class="form-control" id="poReference" placeholder="PO-xxxxxxxx" required>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
                                <input type="date" class="form-control" id="receiptDate" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
                                <input type="text" class="form-control" id="receivedBy" required>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡∏±‡∏û‡∏û‡∏•‡∏≤‡∏¢‡πÄ‡∏≠‡∏≠‡∏£‡πå -->
                <div class="form-section">
                    <h3>
                        <i class="fas fa-truck"></i>
                        ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡∏±‡∏û‡∏û‡∏•‡∏≤‡∏¢‡πÄ‡∏≠‡∏≠‡∏£‡πå
                    </h3>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏ã‡∏±‡∏û‡∏û‡∏•‡∏≤‡∏¢‡πÄ‡∏≠‡∏≠‡∏£‡πå</label>
                                <input type="text" class="form-control" id="supplierName" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                                <input type="tel" class="form-control" id="supplierPhone" required>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</label>
                        <input type="text" class="form-control" id="supplierAddress" required>
                    </div>
                </div>

                <!-- ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
                <div class="form-section">
                    <h3>
                        <i class="fas fa-balance-scale"></i>
                        ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á vs ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö)
                    </h3>
                    <div class="comparison-table">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                                    <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á</th>
                                    <th>‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
                                    <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏à‡∏£‡∏¥‡∏á</th>
                                    <th>‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á</th>
                                    <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                    <th>‡∏•‡∏ö</th>
                                </tr>
                            </thead>
                            <tbody id="comparisonTableBody">
                                <tr>
                                    <td>
                                        <input type="text" class="form-control" name="itemName[]" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" required>
                                    </td>
                                    <td>
                                        <input type="number" class="form-control ordered-qty" name="orderedQty[]" min="1" required>
                                    </td>
                                    <td>
                                        <select class="form-control" name="itemUnit[]" required>
                                            <option value="">‡∏´‡∏ô‡πà‡∏ß‡∏¢</option>
                                            <option value="‡∏Å‡∏Å.">‡∏Å‡∏Å.</option>
                                            <option value="‡∏Å‡∏£‡∏±‡∏°">‡∏Å‡∏£‡∏±‡∏°</option>
                                            <option value="‡∏ä‡∏¥‡πâ‡∏ô">‡∏ä‡∏¥‡πâ‡∏ô</option>
                                            <option value="‡∏•‡∏±‡∏á">‡∏•‡∏±‡∏á</option>
                                        </select>
                                    </td>
                                    <td>
                                        <input type="number" class="form-control received-qty" name="receivedQty[]" min="0" required>
                                    </td>
                                    <td>
                                        <span class="difference">0</span>
                                    </td>
                                    <td>
                                        <span class="status">‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô</span>
                                    </td>
                                    <td>
                                        <button type="button" class="remove-item-btn" onclick="removeComparisonItem(this)">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <button type="button" class="add-item-btn mt-3" onclick="addComparisonItem()">
                        <i class="fas fa-plus"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                    </button>
                </div>

                <!-- ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
                <div class="summary-section">
                    <h4>
                        <i class="fas fa-clipboard-check"></i>
                        ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                    </h4>
                    <div class="summary-item">
                        <span>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</span>
                        <span id="totalItems">1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                    </div>
                    <div class="summary-item">
                        <span>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô:</span>
                        <span id="matchItems" class="text-success">0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                    </div>
                    <div class="summary-item">
                        <span>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏Ç‡∏≤‡∏î:</span>
                        <span id="shortItems" class="text-danger">0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                    </div>
                    <div class="summary-item">
                        <span>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡∏¥‡∏ô:</span>
                        <span id="overItems" class="text-info">0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                    </div>
                    <div class="summary-item highlight">
                        <span>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:</span>
                        <span id="overallStatus">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
                    </div>
                </div>

                <!-- ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ -->
                <div class="form-section">
                    <h3>
                        <i class="fas fa-sticky-note"></i>
                        ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏
                    </h3>
                    <textarea class="form-control" id="receiptNotes" rows="3" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)"></textarea>
                </div>

                <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ -->
                <div class="text-center">
                    <button type="button" class="btn btn-primary me-3" onclick="previewReceipt()">
                        <i class="fas fa-eye"></i> ‡∏î‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
                    </button>
                    <button type="button" class="btn btn-success" onclick="confirmReceipt()">
                        <i class="fas fa-check-circle"></i> ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡∏á
                    </button>
                </div>
            </form>

            <!-- ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ -->
            <div class="preview-section" id="previewSection">
                <h4>
                    <i class="fas fa-file-alt"></i>
                    ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                </h4>
                <div id="previewContent"></div>
                <div class="text-center mt-3">
                    <button type="button" class="btn btn-primary" onclick="printReceipt()">
                        <i class="fas fa-print"></i> ‡∏õ‡∏£‡∏¥‡πâ‡∏ô‡∏ó‡πå‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Generate GR Number
        function generateGRNumber() {
            const date = new Date();
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const time = String(date.getHours()).padStart(2, '0') + String(date.getMinutes()).padStart(2, '0');
            return `GR-${year}${month}${day}-${time}`;
        }

        // Initialize form
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('grNumber').value = generateGRNumber();
            document.getElementById('receiptDate').value = new Date().toISOString().split('T')[0];
            
            // Add event listeners for comparison calculation
            document.addEventListener('input', function(e) {
                if (e.target.classList.contains('ordered-qty') || e.target.classList.contains('received-qty')) {
                    calculateComparison();
                }
            });
        });

        // Add comparison item
        function addComparisonItem() {
            const tbody = document.getElementById('comparisonTableBody');
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td>
                    <input type="text" class="form-control" name="itemName[]" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" required>
                </td>
                <td>
                    <input type="number" class="form-control ordered-qty" name="orderedQty[]" min="1" required>
                </td>
                <td>
                    <select class="form-control" name="itemUnit[]" required>
                        <option value="">‡∏´‡∏ô‡πà‡∏ß‡∏¢</option>
                        <option value="‡∏Å‡∏Å.">‡∏Å‡∏Å.</option>
                        <option value="‡∏Å‡∏£‡∏±‡∏°">‡∏Å‡∏£‡∏±‡∏°</option>
                        <option value="‡∏ä‡∏¥‡πâ‡∏ô">‡∏ä‡∏¥‡πâ‡∏ô</option>
                        <option value="‡∏•‡∏±‡∏á">‡∏•‡∏±‡∏á</option>
                    </select>
                </td>
                <td>
                    <input type="number" class="form-control received-qty" name="receivedQty[]" min="0" required>
                </td>
                <td>
                    <span class="difference">0</span>
                </td>
                <td>
                    <span class="status">‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô</span>
                </td>
                <td>
                    <button type="button" class="remove-item-btn" onclick="removeComparisonItem(this)">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            `;
            tbody.appendChild(newRow);
            calculateComparison();
        }

        // Remove comparison item
        function removeComparisonItem(button) {
            const row = button.closest('tr');
            const tbody = document.getElementById('comparisonTableBody');
            if (tbody.children.length > 1) {
                row.remove();
                calculateComparison();
            } else {
                alert('‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£');
            }
        }

        // Calculate comparison
        function calculateComparison() {
            const rows = document.querySelectorAll('#comparisonTableBody tr');
            let totalItems = 0;
            let matchItems = 0;
            let shortItems = 0;
            let overItems = 0;
            
            rows.forEach(row => {
                const ordered = parseFloat(row.querySelector('.ordered-qty').value) || 0;
                const received = parseFloat(row.querySelector('.received-qty').value) || 0;
                const difference = received - ordered;
                
                const differenceSpan = row.querySelector('.difference');
                const statusSpan = row.querySelector('.status');
                
                if (ordered > 0 && received >= 0) {
                    totalItems++;
                    
                    differenceSpan.textContent = difference > 0 ? `+${difference}` : difference.toString();
                    
                    if (difference === 0) {
                        statusSpan.textContent = '‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô';
                        statusSpan.className = 'status status-match';
                        matchItems++;
                    } else if (difference < 0) {
                        statusSpan.textContent = '‡∏Ç‡∏≤‡∏î';
                        statusSpan.className = 'status status-short';
                        shortItems++;
                    } else {
                        statusSpan.textContent = '‡πÄ‡∏Å‡∏¥‡∏ô';
                        statusSpan.className = 'status status-over';
                        overItems++;
                    }
                } else {
                    differenceSpan.textContent = '0';
                    statusSpan.textContent = '‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô';
                    statusSpan.className = 'status';
                }
            });
            
            // Update summary
            document.getElementById('totalItems').textContent = `${totalItems} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
            document.getElementById('matchItems').textContent = `${matchItems} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
            document.getElementById('shortItems').textContent = `${shortItems} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
            document.getElementById('overItems').textContent = `${overItems} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
            
            // Update overall status
            const overallStatus = document.getElementById('overallStatus');
            if (totalItems === 0) {
                overallStatus.textContent = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
                overallStatus.className = '';
            } else if (matchItems === totalItems) {
                overallStatus.textContent = '‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‚úÖ';
                overallStatus.className = 'text-success';
            } else {
                overallStatus.textContent = '‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏Å‡∏¥‡∏ô ‚ö†Ô∏è';
                overallStatus.className = 'text-warning';
            }
        }

        // Collect form data
        function collectReceiptData() {
            const formData = {
                grNumber: document.getElementById('grNumber').value,
                poReference: document.getElementById('poReference').value,
                receiptDate: document.getElementById('receiptDate').value,
                receivedBy: document.getElementById('receivedBy').value,
                supplier: {
                    name: document.getElementById('supplierName').value,
                    phone: document.getElementById('supplierPhone').value,
                    address: document.getElementById('supplierAddress').value
                },
                items: [],
                notes: document.getElementById('receiptNotes').value
            };
            
            // Collect comparison items
            const rows = document.querySelectorAll('#comparisonTableBody tr');
            rows.forEach(row => {
                const name = row.querySelector('input[name="itemName[]"]').value;
                const ordered = parseFloat(row.querySelector('input[name="orderedQty[]"]').value) || 0;
                const unit = row.querySelector('select[name="itemUnit[]"]').value;
                const received = parseFloat(row.querySelector('input[name="receivedQty[]"]').value) || 0;
                
                if (name && ordered > 0 && unit) {
                    const difference = received - ordered;
                    const status = difference === 0 ? '‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô' : difference > 0 ? '‡πÄ‡∏Å‡∏¥‡∏ô' : '‡∏Ç‡∏≤‡∏î';
                    
                    formData.items.push({
                        name,
                        ordered,
                        received,
                        unit,
                        difference,
                        status
                    });
                }
            });
            
            return formData;
        }

        // Preview receipt
        function previewReceipt() {
            const form = document.getElementById('goodsReceiptForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            const formData = collectReceiptData();
            const previewHTML = generateReceiptPreviewHTML(formData);
            
            document.getElementById('previewContent').innerHTML = previewHTML;
            document.getElementById('previewSection').style.display = 'block';
            
            // Scroll to preview
            document.getElementById('previewSection').scrollIntoView({ behavior: 'smooth' });
        }

        // Generate preview HTML
        function generateReceiptPreviewHTML(data) {
            const matchItems = data.items.filter(item => item.difference === 0).length;
            const shortItems = data.items.filter(item => item.difference < 0).length;
            const overItems = data.items.filter(item => item.difference > 0).length;
            
            let itemsHTML = '';
            data.items.forEach((item, index) => {
                const statusClass = item.difference === 0 ? 'table-success' : 
                                  item.difference > 0 ? 'table-info' : 'table-danger';
                
                itemsHTML += `
                    <tr class="${statusClass}">
                        <td>${index + 1}</td>
                        <td>${item.name}</td>
                        <td class="text-center">${item.ordered}</td>
                        <td class="text-center">${item.received}</td>
                        <td class="text-center">${item.unit}</td>
                        <td class="text-center">${item.difference > 0 ? '+' : ''}${item.difference}</td>
                        <td class="text-center"><strong>${item.status}</strong></td>
                    </tr>
                `;
            });
            
            return `
                <div class="receipt-preview">
                    <div class="text-center mb-4">
                        <h4>‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (Goods Receipt)</h4>
                        <h5>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πä‡∏≠‡∏Ñ‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏≠‡∏ö‡πÅ‡∏´‡πâ‡∏á</h5>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:</strong> ${data.grNumber}<br>
                            <strong>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà PO ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á:</strong> ${data.poReference}<br>
                            <strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:</strong> ${new Date(data.receiptDate).toLocaleDateString('th-TH')}
                        </div>
                        <div class="col-md-6">
                            <strong>‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:</strong> ${data.receivedBy}<br>
                            <strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå:</strong> ${new Date().toLocaleDateString('th-TH')}<br>
                            <strong>‡πÄ‡∏ß‡∏•‡∏≤:</strong> ${new Date().toLocaleTimeString('th-TH')}
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <strong>‡∏ã‡∏±‡∏û‡∏û‡∏•‡∏≤‡∏¢‡πÄ‡∏≠‡∏≠‡∏£‡πå:</strong><br>
                        ${data.supplier.name}<br>
                        ‡πÇ‡∏ó‡∏£: ${data.supplier.phone}<br>
                        ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà: ${data.supplier.address}
                    </div>
                    
                    <table class="table table-bordered">
                        <thead class="table-success">
                            <tr>
                                <th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                                <th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                                <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á</th>
                                <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö</th>
                                <th>‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
                                <th>‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á</th>
                                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${itemsHTML}
                        </tbody>
                    </table>
                    
                    <div class="row">
                        <div class="col-md-8"></div>
                        <div class="col-md-4">
                            <table class="table table-sm">
                                <tr>
                                    <td><strong>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</strong></td>
                                    <td class="text-end">${data.items.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</td>
                                </tr>
                                <tr class="table-success">
                                    <td><strong>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô:</strong></td>
                                    <td class="text-end">${matchItems} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</td>
                                </tr>
                                <tr class="table-danger">
                                    <td><strong>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏î:</strong></td>
                                    <td class="text-end">${shortItems} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</td>
                                </tr>
                                <tr class="table-info">
                                    <td><strong>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏ô:</strong></td>
                                    <td class="text-end">${overItems} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    
                    ${data.notes ? `<div class="mt-3"><strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong><br>${data.notes}</div>` : ''}
                </div>
            `;
        }

        // Print receipt
        function printReceipt() {
            const formData = collectReceiptData();
            const printContent = generateReceiptPrintHTML(formData);
            
            const printWindow = window.open('', '_blank', 'width=800,height=600');
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.print();
        }

        // Generate print HTML
        function generateReceiptPrintHTML(data) {
            const matchItems = data.items.filter(item => item.difference === 0).length;
            const shortItems = data.items.filter(item => item.difference < 0).length;
            const overItems = data.items.filter(item => item.difference > 0).length;
            
            let itemsHTML = '';
            data.items.forEach((item, index) => {
                const statusColor = item.difference === 0 ? '#D1F2D1' : 
                                  item.difference > 0 ? '#CCE5FF' : '#F8D7DA';
                
                itemsHTML += `
                    <tr style="background-color: ${statusColor}">
                        <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${index + 1}</td>
                        <td style="border: 1px solid #ddd; padding: 8px;">${item.name}</td>
                        <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${item.ordered}</td>
                        <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${item.received}</td>
                        <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${item.unit}</td>
                        <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${item.difference > 0 ? '+' : ''}${item.difference}</td>
                        <td style="border: 1px solid #ddd; padding: 8px; text-align: center;"><strong>${item.status}</strong></td>
                    </tr>
                `;
            });
            
            return `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ${data.grNumber}</title>
                    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
                    <style>
                        body { font-family: 'Prompt', Arial, sans-serif; margin: 20px; line-height: 1.6; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .company-info { margin-bottom: 20px; }
                        .receipt-info { display: flex; justify-content: space-between; margin-bottom: 20px; }
                        .supplier-info { margin-bottom: 20px; }
                        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
                        th, td { border: 1px solid #ddd; padding: 8px; }
                        th { background-color: #32CD32; color: white; font-weight: 600; }
                        .summary-section { margin-top: 20px; }
                        .signature-section { margin-top: 50px; display: flex; justify-content: space-between; }
                        .signature-box { text-align: center; width: 200px; }
                        .signature-line { border-bottom: 1px solid #000; margin: 30px 0 10px 0; height: 50px; }
                        @media print {
                            body { margin: 0; font-size: 12px; }
                            .signature-line { height: 40px; margin: 20px 0 10px 0; }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (Goods Receipt)</h1>
                        <h2>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πä‡∏≠‡∏Ñ‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏≠‡∏ö‡πÅ‡∏´‡πâ‡∏á</h2>
                    </div>

                    <div class="company-info">
                        <strong>‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏≠‡∏ö‡πÅ‡∏´‡πâ‡∏á ‡∏à‡∏≥‡∏Å‡∏±‡∏î</strong><br>
                        123 ‡∏ñ‡∏ô‡∏ô‡∏™‡∏∏‡∏Ç‡∏∏‡∏°‡∏ß‡∏¥‡∏ó ‡πÅ‡∏Ç‡∏ß‡∏á‡∏Ñ‡∏•‡∏≠‡∏á‡∏ï‡∏±‡∏ô ‡πÄ‡∏Ç‡∏ï‡∏Ñ‡∏•‡∏≠‡∏á‡∏ï‡∏±‡∏ô ‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø 10110<br>
                        ‡πÇ‡∏ó‡∏£: 02-123-4567 | ‡∏≠‡∏µ‡πÄ‡∏°‡∏•: info@driedfruit.co.th
                    </div>

                    <div class="receipt-info">
                        <div>
                            <strong>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:</strong> ${data.grNumber}<br>
                            <strong>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà PO ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á:</strong> ${data.poReference}<br>
                            <strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:</strong> ${new Date(data.receiptDate).toLocaleDateString('th-TH')}
                        </div>
                        <div>
                            <strong>‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:</strong> ${data.receivedBy}<br>
                            <strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå:</strong> ${new Date().toLocaleDateString('th-TH')}<br>
                            <strong>‡πÄ‡∏ß‡∏•‡∏≤:</strong> ${new Date().toLocaleTimeString('th-TH')}
                        </div>
                    </div>

                    <div class="supplier-info">
                        <strong>‡∏ã‡∏±‡∏û‡∏û‡∏•‡∏≤‡∏¢‡πÄ‡∏≠‡∏≠‡∏£‡πå:</strong><br>
                        ${data.supplier.name}<br>
                        ‡πÇ‡∏ó‡∏£: ${data.supplier.phone}<br>
                        ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà: ${data.supplier.address}
                    </div>

                    <table>
                        <thead>
                            <tr>
                                <th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                                <th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                                <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á</th>
                                <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö</th>
                                <th>‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
                                <th>‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á</th>
                                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${itemsHTML}
                        </tbody>
                    </table>

                    <div class="summary-section">
                        <table style="width: 400px; margin-left: auto;">
                            <tr>
                                <td style="text-align: right; padding: 5px;"><strong>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</strong></td>
                                <td style="text-align: right; padding: 5px;">${data.items.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</td>
                            </tr>
                            <tr style="background-color: #D1F2D1;">
                                <td style="text-align: right; padding: 5px;"><strong>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô:</strong></td>
                                <td style="text-align: right; padding: 5px;">${matchItems} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</td>
                            </tr>
                            <tr style="background-color: #F8D7DA;">
                                <td style="text-align: right; padding: 5px;"><strong>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏î:</strong></td>
                                <td style="text-align: right; padding: 5px;">${shortItems} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</td>
                            </tr>
                            <tr style="background-color: #CCE5FF;">
                                <td style="text-align: right; padding: 5px;"><strong>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏ô:</strong></td>
                                <td style="text-align: right; padding: 5px;">${overItems} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</td>
                            </tr>
                        </table>
                    </div>

                    ${data.notes ? `<div style="margin-top: 20px;"><strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong><br>${data.notes}</div>` : ''}

                    <div class="signature-section">
                        <div class="signature-box">
                            <div class="signature-line"></div>
                            <div>‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
                            <div>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: _______________</div>
                        </div>
                        <div class="signature-box">
                            <div class="signature-line"></div>
                            <div>‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</div>
                            <div>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: _______________</div>
                        </div>
                        <div class="signature-box">
                            <div class="signature-line"></div>
                            <div>‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</div>
                            <div>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: _______________</div>
                        </div>
                    </div>

                    <div style="margin-top: 30px; text-align: center; font-size: 12px; color: #666;">
                        *** ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏≠‡∏≠‡∏Å‡πÇ‡∏î‡∏¢‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πä‡∏≠‡∏Ñ‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏≠‡∏ö‡πÅ‡∏´‡πâ‡∏á ***<br>
                        ${matchItems === data.items.length ? 
                            '‚úÖ ‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡∏ó‡∏∏‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£' : 
                            '‚ö†Ô∏è ‡∏û‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö'}
                    </div>
                </body>
                </html>
            `;
        }

        // Confirm receipt
        function confirmReceipt() {
            const form = document.getElementById('goodsReceiptForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            const formData = collectReceiptData();
            
            if (formData.items.length === 0) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£');
                return;
            }
            
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                // Save receipt data
                const receiptData = {
                    ...formData,
                    timestamp: new Date().toISOString(),
                    status: 'confirmed'
                };
                
                // Save to localStorage (in real app, send to server)
                localStorage.setItem('lastGoodsReceipt', JSON.stringify(receiptData));
                
                // Auto print
                printReceipt();
                
                // Send to Line (placeholder)
                sendReceiptToLine(receiptData);
                
                alert('‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\nüñ®Ô∏è ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏¥‡πâ‡∏ô‡∏ó‡πå‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤\nüì± ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á Line');
                
                // Reset form
                if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                    location.reload();
                }
            }
        }

        // Send to Line (placeholder function)
        function sendReceiptToLine(receiptData) {
            const matchItems = receiptData.items.filter(item => item.difference === 0).length;
            const shortItems = receiptData.items.filter(item => item.difference < 0).length;
            const overItems = receiptData.items.filter(item => item.difference > 0).length;
            
            const message = `üì¶ ‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà: ${receiptData.grNumber}\n` +
                           `üìã PO ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á: ${receiptData.poReference}\n` +
                           `üè¢ ‡∏ã‡∏±‡∏û‡∏û‡∏•‡∏≤‡∏¢‡πÄ‡∏≠‡∏≠‡∏£‡πå: ${receiptData.supplier.name}\n` +
                           `üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: ${new Date(receiptData.receiptDate).toLocaleDateString('th-TH')}\n` +
                           `üìä ‡∏™‡∏£‡∏∏‡∏õ: ${receiptData.items.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‚úÖ${matchItems} ‚ö†Ô∏è${shortItems} ‚ÑπÔ∏è${overItems})\n` +
                           `üë§ ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: ${receiptData.receivedBy}`;
            
            console.log('Line message:', message);
        }
    </script>
</body>
</html>